# Google Drive 連携設定ガイド

Audio VisualizerでGoogle Driveのファイルを使用するには、Google Cloud Platform (GCP) で「Client ID」と「API Key」を取得する必要があります。
以下の手順に従って設定を行ってください。

## 手順 1: プロジェクトの作成

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセスします。
2. Googleアカウントでログインします。
3. 左上のプロジェクト選択ドロップダウンをクリックし、「**新しいプロジェクト**」をクリックします。
4. プロジェクト名（例: `AudioVisualizer`）を入力し、「**作成**」をクリックします。

## 手順 2: APIの有効化

作成したプロジェクトが選択されていることを確認してください。

1. 左側のメニューから「**APIとサービス**」 > 「**有効なAPIとサービス**」を選択します。
2. 「**+ APIとサービスの有効化**」をクリックします。
3. 検索バーに `Google Drive API` と入力して検索し、選択して「**有効にする**」をクリックします。
4. 同様に `Google Picker API` も検索して「**有効にする**」をクリックします。

## 手順 3: OAuth同意画面の設定

Client IDを作成する前に、同意画面を設定する必要があります。

1. 左側のメニューから「**APIとサービス**」 > 「**OAuth同意画面**」を選択します。
2. User Typeで「**外部**」を選択し、「**作成**」をクリックします。
3. **アプリ情報**:
   - アプリ名: `Audio Visualizer` など
   - ユーザーサポートメール: あなたのメールアドレス
   - デベロッパーの連絡先情報: あなたのメールアドレス
4. 「**保存して次へ**」をクリックします。
5. **スコープ**: 特に追加せず「**保存して次へ**」をクリックします。
6. **テストユーザー**:
   - 「**+ ADD USERS**」をクリックし、このアプリを使用するGoogleアカウント（自分）のメールアドレスを追加します。
   - ※これをしないと、認証時にエラーになります。
7. 「**保存して次へ**」をクリックし、最後に「**ダッシュボードに戻る**」をクリックします。

## 手順 4: 認証情報 (API Key と Client ID) の作成

1. 左側のメニューから「**APIとサービス**」 > 「**認証情報**」を選択します。

### API Key の作成
2. 「**+ 認証情報を作成**」 > 「**APIキー**」をクリックします。
3. 生成された文字列が **API Key** です。コピーしてメモしておきます。
   - （推奨）「キーを制限」から、`Google Drive API` と `Google Picker API` のみに制限すると安全です。

### OAuth 2.0 クライアント ID の作成
4. 「**+ 認証情報を作成**」 > 「**OAuth クライアントID**」をクリックします。
5. アプリケーションの種類: 「**ウェブ アプリケーション**」を選択します。
6. 名前: 任意（例: `Web Client`）
7. **承認済みの JavaScript 生成元**:
   - 「**URI を追加**」をクリックし、このサイトを公開するURLを入力します。
   - ローカルでテストする場合（Live Serverなど）は、`http://127.0.0.1:5500` や `http://localhost:5500` などを追加します。
   - **重要**: 末尾にスラッシュ `/` を付けないでください。
8. 「**作成**」をクリックします。
9. 表示された **クライアント ID** （`...apps.googleusercontent.com` で終わる文字列）をコピーしてメモしておきます。

## トラブルシューティング

### 「403. That’s an error.」が表示される場合

このエラーは主に以下の理由で発生します：

1.  **承認済みの JavaScript 生成元が正しくない**:
    - 手順 4-7 を再確認してください。
    - ブラウザのURLバーに表示されているURL（例: `http://127.0.0.1:5500`）と、GCPコンソールに登録したURLが完全に一致している必要があります。
    - **注意**: `localhost` と `127.0.0.1` は別物として扱われます。実際にアクセスしている方（または両方）を登録してください。

2.  **テストユーザーとして登録されていない**:
    - 手順 3-6 を再確認してください。
    - OAuth同意画面が「テスト中」の状態（公開前）の場合、許可されたユーザーしかアクセスできません。自分のメールアドレスが追加されているか確認してください。

3.  **APIが有効になっていない**:
    - 手順 2 を再確認し、`Google Drive API` と `Google Picker API` の両方が「有効」になっているか確認してください。

4.  **APIキーの制限**:
    - APIキーに制限をかけている場合、`Google Picker API` が許可リストに含まれているか確認してください。

### 認証画面で「このアプリは Google で確認されていません」と出る場合
- これは個人開発のアプリでは正常な表示です。「詳細」をクリックし、「Audio Visualizer（安全ではないページ）に移動」をクリックして進めてください。
