# Audio Visualizer — 実装仕様書（改良）v1.0.4
対象: Android (android-app, Capacitor), Web (audio), PC (pc-app, electron) の中で指定されたものに対する。
目的: 以下の機能を安全かつ高性能に実装して、最終的に Android 用 APK をビルドする。

## 実装状況

### android版のみ ✅ 実装完了
- ✅ 前回終了時のパスを記憶しておいて、再起動時に復元するようにしてほしい。
  - `lastSelectedPath`設定を追加、ファイルピッカーとフォルダインポートでパスを保存
- ✅ バックグラウンド再生に対応させる、その時、常時通知として出して、そこで最低限(曲を止めたり前次きりかえたり)の操作が出来るようにする。
  - Media Session API を実装（再生/一時停止/前/次/シーク操作対応）
  - AndroidManifest.xml にフォアグラウンドサービス権限を追加

### web版, PC版の二つ ✅ 実装完了
- ✅ プレイリストタブの移動で、下に移動させたときに、プレイリストタブの上部が隠れないようにする。
  - `scrollToCurrentPlaylistItem()`関数で自動スクロール実装

### 3種すべて ✅ 実装完了
- ✅ GPUを使った処理方法に変えて、GPU処理を優先させる(GPUが出来ない環境ではCPUに自動変更させる)、手動切り替え可能(前回を引き継ぐ)
  - WebGL GPU レンダラー実装、設定で auto/gpu/cpu 切替可能
- ✅ MVのかくつきが目立ってしまうのを改善する。(同期の問題？)
  - GPU レンダリングで改善
- ✅ 複数の曲を読み取っている時などに、動作がかくつきやすいのを改善させる。
  - 非同期処理の最適化
- ✅ UI自動非表示機能のオンオフを可能にする。
  - `autoHideUI`設定を追加、設定パネルでトグル可能
- ✅ プレイリストを特定条件でソートできるようにする。(ボタン押したら条件一覧の物が出て選択するとソートされる)
  - ソートボタン追加（名前順/名前逆順/追加順/追加逆順/ランダム）
- ✅ 新しい種類のビジュアライザーを1~2個追加する。
  - Particles (パーティクル) ビジュアライザー追加
  - Aurora (オーロラ) ビジュアライザー追加
- ✅ バグや不具合など見つけたら修正する。
  - 各種バグ修正済み